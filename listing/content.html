<?php

// All queries that don't look like '/listing/d/' result in a full listing.

$request = $_SERVER['REQUEST_URI'];

if (preg_match('/^\/listing\/[a-z]\/$/', $request) != 1) {
  // List all words.
  $query = 'select word from entries';
  $statement = $db->prepare($query);
  $statement->execute();
  $words = $statement->fetchall(PDO::FETCH_COLUMN, 'word');
  $num_words = count($words);
  $title = count($words)." words in all";
} else {
  // The request looks like this: '/listing/d/'
  $parts = explode('/', $request);   // -> ['', 'listing', 'd', '']
  $initial = $parts[2];              // -> 'd'

  // Run a database query to get all words starting with the initial.
  $query = 'select word from entries where word like ?';
  $statement = $db->prepare($query);
  $statement->execute(array("{$initial}%"));
  $words = $statement->fetchall(PDO::FETCH_COLUMN, 'word');
  $num_words = count($words);
  $plural = $num_words == 1 ? '' : 's';
  $title = $num_words." word{$plural} starting with ".strtoupper($initial);
}

// Output the words as a list of links.
echo "<h2>{$title}</h2>\n";
echo "<ul class=\"listing\">";

foreach ($words as $word) {
  $path = '/entry/'.urlencode($word).'/';
  // Replace hyphens with non-breaking hyphens.
  $word = str_replace('-', '&#8209;', $word);
  $word = str_replace(' ', '&nbsp;', $word);
  $link = "<a href=\"{$path}\">{$word}</a>";
  echo "<li>{$link}</li><wbr />";
}
echo "</ul>\n";

?>
